# FMS Companion Integration

An integration service between the _FIRST Robotics Competition_ Field Management System (FMS) and the Bitfocus Companion app. It wraps the FMS WebSocket integration and triggers Companion buttons based on the FMS state.

## Installation

The communication between the FMS and the Companion app is done using the WebSocket protocol. As the A/V setup is usually uses a different network than the FMS, you will need to have a proxy server.

This project is built using Node.js and npm. To install, clone the repository and run `npm install` to install the dependencies.

```bash
git clone https://github.com/ofekashery/fms-companion.git
cd fms-companion
npm install
```

### Run the proxy server

```bash
npm run proxy
```

### Run the integration server

To connect the FMS using proxy server at `ws://localhost:1234` with the Companion app at `localhost:8888`, run the following command:

```bash
npm run start -w ws://localhost:1234 -c localhost:8888
```

## Configuration

Once the server is running, you can access the configuration page at `http://localhost:8081`. The configuration page allows you to set the Companion button IDs for each FMS state.
The button IDs can found in the Companion app, on the topbar of each button, and are in the format of `page.button` (e.g. `1.2` or `1.16`).

## Scenes

- **FMS_FULL** - Used whenever the output is a full-screen display that showing from FMS, such as the messages generated by the scorekeeper. It should contain the Chroma filter.
- **FMS_HIDDEN** - Used whenever the FMS Audience Display is not supposed to be seen, or has finished showing data. For example, after showing match preview.
- **FMS_SCORE** - Used during Match Play. It must, at minimum, show the score bar generated by FMS. It should contain the Chroma filter.
- **FMS_RESULT** - Used during the Post Result after a match.
- **FMS_ALLIANCE** - Used during the Alliance Selection. It should contain the Chroma filter if using the Alliance Hybrid View.
- **FMS_AWARDS** - The output during Award Ceremonies. It should accommodate the lower third bar that shows the award being presented and the winning team. It should contain the Chroma filter.
